{"ast":null,"code":"var _jsxFileName = \"E:\\\\hotel\\\\frontend\\\\src\\\\components\\\\Menu.js\",\n  _s = $RefreshSig$();\n// src/components/Menu.js\nimport React, { useEffect, useState } from \"react\";\nimport { useLocation } from \"react-router-dom\"; // Use useLocation for query params\nimport axios from \"axios\";\nimport { io } from \"socket.io-client\";\nimport \"./Menu.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io(\"http://localhost:5000\");\nfunction Menu() {\n  _s();\n  // CRITICAL FIX: Reading the table number from query parameters\n  const location = useLocation();\n  const queryParams = new URLSearchParams(location.search);\n  const tableNumber = queryParams.get(\"table\");\n  const [menu, setMenu] = useState([]);\n  const [cart, setCart] = useState({});\n  const [isConnected, setIsConnected] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [socketState, setSocketState] = useState(null); // Renamed to avoid confusion\n\n  // ... (Your useEffect, addToCart, removeFromCart, updateCartQuantity logic)\n\n  useEffect(() => {\n    // Fetch menu items\n    const fetchMenu = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/api/menu\");\n        setMenu(res.data);\n      } catch (err) {\n        console.error(\"Failed to fetch menu:\", err);\n      }\n    };\n    fetchMenu();\n\n    // Initialize socket connection\n    const newSocket = io(\"http://localhost:5000\");\n    setSocketState(newSocket);\n\n    // Socket event listeners\n    newSocket.on(\"connect\", () => setIsConnected(true));\n    newSocket.on(\"disconnect\", () => setIsConnected(false));\n    newSocket.on(\"connect_error\", error => console.error(\"Connection error:\", error));\n    newSocket.on(\"stockUpdate\", updatedItems => {\n      setMenu(prevMenu => prevMenu.map(item => {\n        const updated = updatedItems.find(u => u._id === item._id);\n        return updated ? updated : item;\n      }));\n    });\n\n    // Cleanup function\n    return () => {\n      newSocket.close();\n    };\n  }, [tableNumber]);\n  const placeOrder = async () => {\n    if (Object.keys(cart).length === 0) {\n      alert(\"Your cart is empty!\");\n      return;\n    }\n\n    // CRITICAL VALIDATION: Check if tableNumber is valid before proceeding\n    if (!tableNumber || isNaN(Number(tableNumber)) || Number(tableNumber) <= 0) {\n      alert(\"Error: Invalid table number. Please select your table again.\");\n      return;\n    }\n    const orderItems = Object.values(cart).filter(item => item && item._id && item.quantity > 0).map(item => ({\n      menuId: item._id,\n      quantity: item.quantity\n    }));\n    if (orderItems.length === 0) {\n      alert(\"Cannot place order. Please add valid items to your cart.\");\n      setCart({});\n      return;\n    }\n    const totalAmount = Object.values(cart).reduce((sum, item) => sum + item.price * item.quantity, 0);\n    setIsLoading(true);\n    try {\n      await axios.post(\"http://localhost:5000/api/orders\", {\n        tableNumber: Number(tableNumber),\n        // CRITICAL: Ensure it's sent as a number\n        items: orderItems,\n        totalAmount\n      });\n      alert(\"Order placed successfully! ✅\");\n      setCart({});\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error(\"Order submission failed completely. Backend response:\", err.response ? err.response.data : err.message);\n      let errorMessage = \"Order failed. Please check stock or see console for details.\";\n      if ((_err$response = err.response) !== null && _err$response !== void 0 && (_err$response$data = _err$response.data) !== null && _err$response$data !== void 0 && _err$response$data.error) {\n        errorMessage = err.response.data.error;\n      }\n      alert(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // ... (rest of the component's rendering logic)\n\n  // NOTE: You must include the remaining functional and stylistic code for the Menu component.\n  // The full attractive UI code was provided in previous responses.\n\n  const totalAmount = Object.values(cart).reduce((sum, item) => sum + item.price * item.quantity, 0);\n  const totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);\n  return (\n    /*#__PURE__*/\n    // ... (Your JSX structure here)\n    _jsxDEV(\"div\", {\n      className: \"menu-page-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"menu-container\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-header\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"page-subtitle\",\n            children: [\"Menu for Table \", tableNumber]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 5\n    }, this)\n  );\n}\n_s(Menu, \"kZlYfmFaKIDk7bhq7nHVqF1iwVA=\", false, function () {\n  return [useLocation];\n});\n_c = Menu;\nexport default Menu;\nvar _c;\n$RefreshReg$(_c, \"Menu\");","map":{"version":3,"names":["React","useEffect","useState","useLocation","axios","io","jsxDEV","_jsxDEV","socket","Menu","_s","location","queryParams","URLSearchParams","search","tableNumber","get","menu","setMenu","cart","setCart","isConnected","setIsConnected","isLoading","setIsLoading","socketState","setSocketState","fetchMenu","res","data","err","console","error","newSocket","on","updatedItems","prevMenu","map","item","updated","find","u","_id","close","placeOrder","Object","keys","length","alert","isNaN","Number","orderItems","values","filter","quantity","menuId","totalAmount","reduce","sum","price","post","items","_err$response","_err$response$data","response","message","errorMessage","totalItems","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/hotel/frontend/src/components/Menu.js"],"sourcesContent":["// src/components/Menu.js\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useLocation } from \"react-router-dom\"; // Use useLocation for query params\r\nimport axios from \"axios\";\r\nimport { io } from \"socket.io-client\";\r\nimport \"./Menu.css\";\r\n\r\nconst socket = io(\"http://localhost:5000\");\r\n\r\nfunction Menu() {\r\n  // CRITICAL FIX: Reading the table number from query parameters\r\n  const location = useLocation();\r\n  const queryParams = new URLSearchParams(location.search);\r\n  const tableNumber = queryParams.get(\"table\"); \r\n  \r\n  const [menu, setMenu] = useState([]);\r\n  const [cart, setCart] = useState({});\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [socketState, setSocketState] = useState(null); // Renamed to avoid confusion\r\n\r\n  // ... (Your useEffect, addToCart, removeFromCart, updateCartQuantity logic)\r\n\r\n  useEffect(() => {\r\n    // Fetch menu items\r\n    const fetchMenu = async () => {\r\n      try {\r\n        const res = await axios.get(\"http://localhost:5000/api/menu\");\r\n        setMenu(res.data);\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch menu:\", err);\r\n      }\r\n    };\r\n\r\n    fetchMenu();\r\n\r\n    // Initialize socket connection\r\n    const newSocket = io(\"http://localhost:5000\");\r\n    setSocketState(newSocket);\r\n\r\n    // Socket event listeners\r\n    newSocket.on(\"connect\", () => setIsConnected(true));\r\n    newSocket.on(\"disconnect\", () => setIsConnected(false));\r\n    newSocket.on(\"connect_error\", (error) => console.error(\"Connection error:\", error));\r\n\r\n    newSocket.on(\"stockUpdate\", (updatedItems) => {\r\n      setMenu(prevMenu =>\r\n        prevMenu.map(item => {\r\n          const updated = updatedItems.find(u => u._id === item._id);\r\n          return updated ? updated : item;\r\n        })\r\n      );\r\n    });\r\n    \r\n    // Cleanup function\r\n    return () => {\r\n      newSocket.close();\r\n    };\r\n  }, [tableNumber]);\r\n\r\n  const placeOrder = async () => {\r\n    if (Object.keys(cart).length === 0) {\r\n      alert(\"Your cart is empty!\");\r\n      return;\r\n    }\r\n    \r\n    // CRITICAL VALIDATION: Check if tableNumber is valid before proceeding\r\n    if (!tableNumber || isNaN(Number(tableNumber)) || Number(tableNumber) <= 0) {\r\n        alert(\"Error: Invalid table number. Please select your table again.\");\r\n        return;\r\n    }\r\n\r\n    const orderItems = Object.values(cart)\r\n      .filter(item => item && item._id && item.quantity > 0)\r\n      .map(item => ({\r\n        menuId: item._id,\r\n        quantity: item.quantity,\r\n      }));\r\n\r\n    if (orderItems.length === 0) {\r\n      alert(\"Cannot place order. Please add valid items to your cart.\");\r\n      setCart({});\r\n      return;\r\n    }\r\n\r\n    const totalAmount = Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      await axios.post(\"http://localhost:5000/api/orders\", {\r\n        tableNumber: Number(tableNumber), // CRITICAL: Ensure it's sent as a number\r\n        items: orderItems,\r\n        totalAmount\r\n      });\r\n\r\n      alert(\"Order placed successfully! ✅\");\r\n      setCart({});\r\n    } catch (err) {\r\n      console.error(\"Order submission failed completely. Backend response:\", err.response ? err.response.data : err.message);\r\n      let errorMessage = \"Order failed. Please check stock or see console for details.\";\r\n      if (err.response?.data?.error) {\r\n        errorMessage = err.response.data.error;\r\n      }\r\n      alert(errorMessage);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n  \r\n  // ... (rest of the component's rendering logic)\r\n\r\n  // NOTE: You must include the remaining functional and stylistic code for the Menu component.\r\n  // The full attractive UI code was provided in previous responses.\r\n  \r\n  const totalAmount = Object.values(cart).reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n  const totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);\r\n\r\n  return (\r\n    // ... (Your JSX structure here)\r\n    <div className=\"menu-page-wrapper\">\r\n      <div className=\"menu-container\">\r\n        <div className=\"page-header\">\r\n          {/* ... */}\r\n          <p className=\"page-subtitle\">Menu for Table {tableNumber}</p>\r\n          {/* ... */}\r\n        </div>\r\n        {/* ... (Your menu rendering JSX here) ... */}\r\n      </div>\r\n      {/* ... (Your sticky cart JSX here) ... */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Menu;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}